rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ------------------------------
    // ğŸ”¹ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø¯ÙŠØ±
    // ------------------------------
    function isAdmin() {
      return request.auth != null && request.auth.token.email == "sagralnarey@gmail.com";
    }

    // ------------------------------
    // ğŸ”¹ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø¯ÙŠØ±
    // ------------------------------
    match /{document=**} {
      allow read, write: if isAdmin();
    }
    
    match /matches/{matchId} {
        allow read: if request.auth != null;
    }
    
    match /matches/{path=**} {
        allow read: if request.auth != null;
    }

    // ------------------------------
    // ğŸ”¹ ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    // ------------------------------
    match /predictions/{predictionId} {
      // Ù‚Ø±Ø§Ø¡Ø© ÙˆØªØµÙØ­ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·
      allow read, list: if request.auth != null && (
        predictionId.startsWith(request.auth.uid)
      );
      // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø­Ø°Ù ØªÙˆÙ‚Ø¹ ÙÙ‚Ø· Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡
      allow write: if request.auth != null && request.resource.data.userId == request.auth.uid;
    }

    // ------------------------------
    // ğŸ”¹ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    // ------------------------------
    match /dailyGlobalPredictions/{date} {
      // ÙŠÙ…ÙƒÙ† Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù‚Ø±Ø§Ø¡Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      allow read, list: if request.auth != null;
      // ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      allow write: if isAdmin();
    }

    // ------------------------------
    // ğŸ”¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    // ------------------------------
    match /users/{userId}/notifications/{notificationId} {
      allow read, delete: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }

    // ------------------------------
    // ğŸ”¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
    // ------------------------------
    match /matches/{matchId}/comments/{commentId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && (
        resource.data.userId == request.auth.uid || isAdmin()
      );
    }

    // ------------------------------
    // ğŸ”¹ Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
    // ------------------------------
    match /matches/{matchId}/comments/{commentId}/replies/{replyId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && (
        resource.data.userId == request.auth.uid || isAdmin()
      );
    }

    // ------------------------------
    // ğŸ”¹ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª
    // ------------------------------
    match /matches/{matchId}/comments/{commentId}/likes/{userId} {
      allow read: if request.auth != null;
      allow create, delete: if request.auth != null && request.auth.uid == userId;
    }

    match /matches/{matchId}/comments/{commentId}/replies/{replyId}/likes/{userId} {
      allow read: if request.auth != null;
      allow create, delete: if request.auth != null && request.auth.uid == userId;
    }

    // ------------------------------
    // ğŸ”¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©
    // ------------------------------
    match /favorites/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ------------------------------
    // ğŸ”¹ Ù„ÙˆØ­Ø§Øª Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³Ø§Øª
    // ------------------------------
    match /leaderboard/{userId} {
      allow read: if request.auth != null;
    }

    match /managedCompetitions/{leagueId} {
      allow read: if request.auth != null;
    }
    
    match /adminFavorites/{teamId} {
      allow read: if request.auth != null;
    }
    
    match /leagueCustomizations/{leagueId} {
      allow read: if request.auth != null;
    }
    
    match /countryCustomizations/{countryName} {
      allow read: if request.auth != null;
    }
    
    match /continentCustomizations/{continentName} {
      allow read: if request.auth != null;
    }
    
    match /teamCustomizations/{teamId} {
      allow read: if request.auth != null;
    }
    
    match /playerCustomizations/{playerId} {
      allow read: if request.auth != null;
    }
    
    match /coachCustomizations/{coachId} {
      allow read: if request.auth != null;
    }
    
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

  }
}